version: "2"
sql:
  - engine: "postgresql"
    queries: "./queries"
    schema: "schema.sql"
    codegen:
      # Plugin configuration for sqlc-gen-go
      - plugin: "sqlc-gen-go"
        out: "../sqlcout"
        options:
          package: "query"
          sql_package: "pgx/v5"
          output_query_files_directory: "query"
          output_db_file_name: "query/queries.gen.go"
          output_files_suffix: ".gen"
          output_models_file_name: "entity/model.gen.go"
          output_models_package: "entity"
          models_package_import_path: "github.com/sqlc-dev/sqlc-gen-go/example/sqlcout/entity"
          emit_result_struct_pointers: true
          emit_params_struct_pointers: true
          nested:
            composites:
              - name: "GetAuthorBook"
                group:
                  - struct_in: "Review"
                    struct_out: "GetAuthorBookReview"
            queries:
              - query: "GetAuthors"
                struct_root: "GetAuthorsGroup"
                group:
                  - struct_in: "Book"
                    struct_out: "GetAuthorBook"
                    field_out: "Publications" # Custom field name in result struct instead of "Books"
                    composite: true
                  - struct_in: "Label"
                    field_out: "AuthorLabels" # Custom field name instead of "Labels"
              - query: "GetAuthor"
                struct_root: "GetAuthorGroup"
                group:
                  - struct_in: "Book"
                    struct_out: "GetAuthorBook"
                    composite: true
                  - struct_in: "Label"
                    field_out: "AuthorLabels"
              # Test composite functionality - reuse GetAuthorBook structure
              - query: "GetBooks"
                struct_root: "GetBooksGroup"
                field_group_by: "AuthorID" # Group by AuthorID which is available in root
                group:
                  - struct_in: "Book"
                    struct_out: "GetAuthorBook"
                    composite: true # Reuse the existing GetAuthorBook structure

plugins:
  - name: sqlc-gen-go
    process:
      cmd: "/Users/dvashchil/code/fork/sqlc-gen-go/bin/sqlc-gen-go"
    # wasm:
    #   url: file:///Users/dvashchil/code/fork/sqlc-gen-go/bin/sqlc-gen-go.wasm
